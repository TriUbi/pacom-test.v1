@page "/login"
@inject HttpClient Http
@inject NavigationManager Nav

<h3>Logga in üõ°Ô∏è</h3>

@if (errorMessage != null)
{
    <p class="text-danger">@errorMessage</p>
}

<div class="mb-3">
    <input class="form-control" placeholder="Anv√§ndarnamn" @bind="username" />
</div>
<div class="mb-3">
    <input class="form-control" type="password" placeholder="L√∂senord" @bind="password" />
</div>
<button class="btn btn-primary" @onclick="Login">Logga in</button>

@code {
    private string username = "";
    private string password = "";
    private string? errorMessage;

    private async Task Login()
    {
        var loginData = new { username, password };

        try
        {
            var response = await Http.PostAsJsonAsync("http://localhost:5277/api/auth/login", loginData);

            if (response.IsSuccessStatusCode)
            {
                var result = await response.Content.ReadFromJsonAsync<TokenResult>();
                if (result is not null)
                {
                    // Spara token i localStorage eller i minnet (f√∂r enkelhet, vi b√∂rjar med minnet)
                    JwtStore.Token = result.Token;

                    // Navigera till huvudvyn
                    Nav.NavigateTo("/");
                }
            }
            else
            {
                errorMessage = "Felaktigt anv√§ndarnamn eller l√∂senord.";
            }
        }
        catch
        {
            errorMessage = "Fel vid inloggning.";
        }
    }

    private class TokenResult
    {
        public string Token { get; set; } = string.Empty;
    }
}
